---
title: "Homework 6"
author: "Sarah Younes"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message = FALSE}
library(tidyverse)
set.seed(1)
```

## Problem 1

First, I will import and clean the data, including filtering the data to necessary items.

```{r cleaning homicide data}
homicide_data =
  read.csv(
    "./data/homicide-data.csv",
    na = "Unknown") |>
  janitor::clean_names() |>
  drop_na() |>
  mutate(
    victim_last = str_to_title(victim_last),
    victim_first = str_to_title(victim_first),
    city_state = paste(city, state, sep = ", "),
    victim_age = as.numeric(victim_age),
    status = case_when(
      disposition == "Closed without arrest" ~ "Solved",
      disposition == "Closed by arrest" ~ "Solved",
      disposition == "Open/No arrest" ~ "Unsolved")) |>
  filter(!(city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, OK"))) |>
  filter(victim_race == "White" | victim_race == "Black")
```

Now, I will fit a logistic regression for Baltimore, MD with `status` as the outcome and `victim_age`, `victim_sex`, and `victim_race` as predictors. I will tidy the output and obtain an estimate of the odds ratio.

```{r logistic regression}
regression_data =
  homicide_data |>
  mutate(
    status = case_when(
      status == "Solved" ~ 1,
      status == "Unsolved" ~ 0))

status_fit =
  glm(status ~ victim_age + victim_sex + victim_race, data = regression_data, family = "binomial") |>
  broom::tidy() |>
  mutate(OR = exp(estimate))

status_fit
```

## Problem 2

First, I will download and clean the weather data set as instructed.

```{r cleaning weather data, message = FALSE}
weather_df = 
  rnoaa::meteo_pull_monitors(
    c("USW00094728"),
    var = c("PRCP", "TMIN", "TMAX"), 
    date_min = "2022-01-01",
    date_max = "2022-12-31") |>
  mutate(
    name = recode(id, USW00094728 = "CentralPark_NY"),
    tmin = tmin / 10,
    tmax = tmax / 10) |>
  select(name, id, everything())
```

Now, I will create a simple linear regression with `tmax` as the outcome and `tmin` and `prcp` as the predictors.

```{r linear regression}
tmax_fit = lm(tmax ~ tmin + prcp, data = weather_df)
```

Now, I will pull r-squared.

```{r}
r2 =
  tmax_fit |>
  broom::glance() |>
  select(r.squared)
```

Now, I will pull β̂ 1 and β̂ 2.

```{r}
betas =
  tmax_fit |>
  broom::tidy() |>
  select(term, estimate)

beta1 = 
  betas |>
  filter(term == "tmin") |>
  select(estimate)

beta2 =
  betas |>
  filter(term == "prcp") |>
  select(estimate)

log_beta1_beta2 = log(beta1 * beta2)

df =
  tibble(
    r2 = r2,
    log = log_beta1_beta2
  )
```

I will create the bootstrap sample function.

```{r}
boot_sample = function(df) {
  sample_frac(df, replace = TRUE)
}

## I should also test if it is working
```

Next, I will draw 5000 bootstrap samples.

```{r}
boot_straps = 
  tibble(strap_number = 1:5000) |> 
  mutate(
    strap_sample_r2 = map(strap_number, \(i) boot_sample(df = df)))

boot_straps
```

Now, I will identify the 2.5% and 97.5% quantiles to provide a 95% confidence interval for r-squared and the log of B1 and B2.

```{r}
```

## Problem 3

I will import the birthweight data set.

```{r}
birthweight_df =
  read_csv("./data/birthweight.csv")
```

```{r ggplots}
birthweight_df |>
  ggplot(aes(x = babysex, y = bwt, group = babysex)) + geom_boxplot()

birthweight_df |>
  ggplot(aes(x = bhead, y = bwt)) + geom_point()

birthweight_df |>
  ggplot(aes(x = blength, y = bwt)) + geom_point()

birthweight_df |>
  ggplot(aes(x = delwt, y = bwt)) + geom_point()

birthweight_df |>
  ggplot(aes(x = fincome, y = bwt)) + geom_point()

birthweight_df |>
  ggplot(aes(x = frace, y = bwt, group = frace)) + geom_violin()

birthweight_df |>
  ggplot(aes(x = gaweeks, y = bwt)) + geom_point()

birthweight_df |>
  ggplot(aes(x = malform, y = bwt, group = malform)) + geom_boxplot()

birthweight_df |>
  ggplot(aes(x = menarche, y = bwt)) + geom_point()

birthweight_df |>
  ggplot(aes(x = mheight, y = bwt)) + geom_point()

birthweight_df |>
  ggplot(aes(x = momage, y = bwt)) + geom_point()

birthweight_df |>
  ggplot(aes(x = mrace, y = bwt, group = mrace)) + geom_violin()

birthweight_df |>
  ggplot(aes(x = parity, y = bwt)) + geom_point()

birthweight_df |>
  ggplot(aes(x = ppbmi, y = bwt)) + geom_point()

birthweight_df |>
  ggplot(aes(x = ppwt, y = bwt)) + geom_point()

birthweight_df |>
  ggplot(aes(x = smoken, y = bwt)) + geom_point()

birthweight_df |>
  ggplot(aes(x = wtgain, y = bwt)) + geom_point()

## pnumlbw and pnumsga were all 0 so they were excluded from plots
```

```{r correlations}
cor.test(birthweight_df$bwt, birthweight_df$bhead, method = "pearson")

cor.test(birthweight_df$bwt, birthweight_df$blength, method = "pearson")

cor.test(birthweight_df$bwt, birthweight_df$delwt, method = "pearson")

cor.test(birthweight_df$bwt, birthweight_df$fincome, method = "pearson")

cor.test(birthweight_df$bwt, birthweight_df$gaweeks, method = "pearson")

cor.test(birthweight_df$bwt, birthweight_df$menarche, method = "pearson")

cor.test(birthweight_df$bwt, birthweight_df$mheight, method = "pearson")

cor.test(birthweight_df$bwt, birthweight_df$momage, method = "pearson")

cor.test(birthweight_df$bwt, birthweight_df$parity, method = "pearson")

cor.test(birthweight_df$bwt, birthweight_df$ppbmi, method = "pearson")

cor.test(birthweight_df$bwt, birthweight_df$ppwt, method = "pearson")

cor.test(birthweight_df$bwt, birthweight_df$smoken, method = "pearson")

cor.test(birthweight_df$bwt, birthweight_df$wtgain, method = "pearson")

t.test(birthweight_df$bwt, birthweight_df$babysex)

t.test(birthweight_df$bwt, birthweight_df$malform)

aov(birthweight_df$bwt ~ birthweight_df$frace)

aov(birthweight_df$bwt ~ birthweight_df$mrace)

## pnumlbw and pnumsga were all 0 so they were excluded from correlation testing
```

High correlations above 0.7: bhead, blength

*Add-predictions & add_residuals

Now, I will compare my model to two others:

```{r}
model_1 = lm(bwt ~ blength + gaweeks, data = birthweight_df)

model_2 = lm(bwt ~ bhead + blength + babysex + (bhead * blength * babysex), data = birthweight_df)
```